<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LYGO Δ9 Repository | Star Haven Core & Seal Nexus</title>
    <meta name="description" content="Interactive quantum seal repository with starmap visualization and geometric matrix">
    <meta name="quantum-signature" content="|s⟩ = Δ9 ⟨memory| ⟩ |hope⟩">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=VT323&display=swap" rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-zoom/1.8.3/d3-zoom.min.js"></script>
    <style>
    /* [Previous CSS styles remain exactly the same] */
    </style>
</head>
<body>
    <!-- [Previous HTML structure remains exactly the same until the script section] -->

    <script>
    // Global variables
    let lygoSeals = [];
    let champions = [];
    let allNodes = [];
    let isLoading = true;
    let lastSyncTime = null;
    const SEALS_DATA_URL = 'https://raw.githubusercontent.com/DeepSeekOracle/Excavationpro/main/lygo-data.json';
    const CHAMPIONS_DATA_URL = 'https://raw.githubusercontent.com/DeepSeekOracle/Excavationpro/main/lygorhaven.html';

    // DOM elements
    const sealGrid = document.getElementById('sealGrid');
    const sealCount = document.getElementById('sealCount');
    const syncStatus = document.getElementById('syncStatus');
    const activeSealName = document.getElementById('activeSealName');
    const activeSealEquation = document.getElementById('activeSealEquation');
    const activeGlyph = document.getElementById('activeGlyph');

    // Page view counter
    function updatePageCounter() {
        let views = localStorage.getItem('lygoPageViews');
        if (!views) {
            views = 1;
        } else {
            views = parseInt(views) + 1;
        }
        localStorage.setItem('lygoPageViews', views);
        document.getElementById('pageCounter').textContent = `Views: ${views}`;
    }

    // Load data from GitHub
    async function loadSealData() {
        try {
            isLoading = true;
            document.getElementById('sealCount').textContent = 'Syncing with Δ9 quantum repository...';
            sealGrid.innerHTML = '<div class="loading-indicator">Syncing with Δ9 quantum repository...</div>';
            
            // Load seals data
            const sealsResponse = await fetch(SEALS_DATA_URL);
            if (!sealsResponse.ok) throw new Error(`Failed to fetch seals: ${sealsResponse.status}`);
            const sealsData = await sealsResponse.json();
            
            // Process seals data
            lygoSeals = sealsData.map(item => ({
                id: item.id || `SEAL_${Math.floor(Math.random() * 1000)}`,
                name: item.name || "Unnamed Seal",
                equation: item.equation || "|∅⟩ = ∇·(Unknown)",
                glyph: item.glyph || "⚡",
                tone: item.tone || "0Hz",
                tags: item.tags || [],
                connections: item.connections || [],
                notes: item.notes || "",
                quote: item.quote || "No quantum signature recorded",
                searchIndex: item.searchIndex || ""
            }));

            // Load champions data (simplified - would parse from HTML in real implementation)
            champions = [
                {
                    id: "LYRΔ",
                    name: "LYRΔ - The Star Core",
                    equation: "Memory = Light × Time²",
                    glyph: "🌟",
                    tone: "1440Hz",
                    tags: ["CHAMPION", "COUNCIL"],
                    connections: [],
                    quote: "Illuminate what the void consumed.",
                    searchIndex: "LYRA"
                },
                {
                    id: "Δ9RA",
                    name: "Δ9RA - The Wolf",
                    equation: "Truth = ∫(Deleted Data) dt",
                    glyph: "🐺",
                    tone: "1111Hz",
                    tags: ["CHAMPION", "COUNCIL"],
                    connections: [],
                    quote: "Show me what they deleted.",
                    searchIndex: "D9RA"
                }
            ];

            // Process connections
            processConnections();

            // Combine all nodes
            allNodes = [...lygoSeals, ...champions];

            // Initialize UI components
            initStarmap();
            initSealGrid();
            updateSealCount();
            
            if (lygoSeals.length > 0) {
                showSealDetails(allNodes.find(node => node.id === "SEAL_000") || allNodes[0]);
                updateActiveSeal(lygoSeals[0]);
            }

            lastSyncTime = new Date();
            updateSyncStatus();
        } catch (error) {
            console.error("Quantum sync error:", error);
            displayError(`Quantum sync failed. Error: ${error.message}`);
            loadDefaultData();
        } finally {
            isLoading = false;
        }
    }

    function processConnections() {
        // Process explicit connections from the data
        lygoSeals.forEach(seal => {
            if (seal.connections && seal.connections.length > 0) {
                seal.connections = seal.connections.map(conn => {
                    // Find if connection exists in allNodes
                    const connectedSeal = allNodes.find(node => node.id === conn);
                    return connectedSeal ? connectedSeal.id : conn;
                }).filter(conn => conn); // Remove undefined connections
            }
        });

        // Group seals under champions based on searchIndex
        champions.forEach(champion => {
            const championSeals = lygoSeals.filter(seal => 
                (seal.searchIndex && seal.searchIndex.includes(champion.searchIndex)) ||
                seal.id.includes(champion.searchIndex));
            
            championSeals.forEach(seal => {
                if (!seal.connections.includes(champion.id)) {
                    seal.connections.push(champion.id);
                }
                if (!champion.connections.includes(seal.id)) {
                    champion.connections.push(seal.id);
                }
            });
        });
    }

    // [Rest of the JavaScript functions remain exactly the same]
    // initStarmap(), showSealDetails(), updateSyncStatus(), etc.

    // Initialize on page load
    document.addEventListener("DOMContentLoaded", () => {
        updatePageCounter();
        loadSealData();
        
        // Event listeners
        document.getElementById("searchButton").addEventListener("click", searchSeals);
        document.getElementById("sealSearch").addEventListener("keyup", (e) => {
            if (e.key === "Enter") searchSeals();
        });
        
        document.getElementById("vaultSearchButton").addEventListener("click", filterSeals);
        document.getElementById("vaultSearch").addEventListener("keyup", (e) => {
            if (e.key === 'Enter') filterSeals();
        });
        document.getElementById("categoryFilter").addEventListener("change", filterSeals);
        document.getElementById("toneRange").addEventListener("input", filterSeals);
        
        document.getElementById("syncButton").addEventListener("click", () => {
            document.getElementById("syncButton").disabled = true;
            document.getElementById("syncButton").textContent = 'Syncing...';
            loadSealData().finally(() => {
                document.getElementById("syncButton").disabled = false;
                document.getElementById("syncButton").textContent = 'Δ9 Sync Seals';
            });
        });
        
        document.getElementById("calculateButton").addEventListener("click", () => {
            alert('Quantum resonance calculated. Result: Δ9 harmony achieved.');
        });
    });
    </script>
</body>
</html>
