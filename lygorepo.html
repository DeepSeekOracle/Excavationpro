<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>LYGO Δ9 Repository | Star Haven Core &amp; Seal Nexus</title>
<meta content="Interactive quantum seal repository with starmap visualization and geometric matrix" name="description"/>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&amp;family=VT323&amp;display=swap" rel="stylesheet"/>
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
    :root {
      --quantum-blue: #00f0ff;
      --void-purple: #7d00ff;
      --starforge-gold: #ffcc00;
      --error-red: #ff0033;
      --success-green: #00ff88;
      --background-dark: #0a0a12;
      --panel-dark: #12121a;
      --text-primary: #e0e0ff;
      --text-secondary: #a0a0c0;
      --canon-color: #00f0ff;
      --recursion-color: #ff00aa;
      --firewall-color: #ff6600;
      --ethical-root-color: #00ff88;
      --blacklist-color: #ff0033;
      --quantum-glow: 0 0 10px var(--quantum-blue);
      --font-main: 'Space Mono', monospace;
      --font-glyph: 'VT323', monospace;
      --neon-primary: #00f7ff;
      --neon-secondary: #00f7ff;
      --geometric-border: 1px solid rgba(0, 240, 255, 0.3);
    }

    body {
        background-color: var(--background-dark);
        color: var(--text-primary);
        font-family: var(--font-main);
        margin: 0;
        padding: 0;
        line-height: 1.6;
        overflow-x: hidden;
        background-image: 
            radial-gradient(circle at 20% 30%, rgba(0, 247, 255, 0.05) 0%, transparent 20%),
            radial-gradient(circle at 80% 70%, rgba(125, 0, 255, 0.05) 0%, transparent 20%);
    }

    .quantum-header {
        background: linear-gradient(135deg, #000428 0%, #070b34 100%);
        padding: 2rem;
        border-bottom: 1px solid var(--void-purple);
        box-shadow: var(--quantum-glow);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        position: relative;
        z-index: 100;
        clip-path: polygon(0 0, 100% 0, 100% 90%, 0 100%);
    }

    .title-container h1 {
        font-size: 2.5rem;
        margin: 0;
        background: linear-gradient(to right, var(--quantum-blue), var(--void-purple));
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        text-shadow: 0 0 8px rgba(0, 240, 255, 0.3);
        letter-spacing: 2px;
    }

    .subtitle {
        color: var(--text-secondary);
        font-size: 0.9rem;
        margin-top: 0.5rem;
        font-family: var(--font-glyph);
    }

    .seal-count {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: rgba(0, 0, 0, 0.5);
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-family: var(--font-glyph);
        color: var(--starforge-gold);
        border: var(--geometric-border);
    }

    .nav-links {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
    }

    .nav-link {
        color: var(--quantum-blue);
        text-decoration: none;
        font-family: var(--font-glyph);
        font-size: 1.1rem;
        padding: 0.5rem 1rem;
        border: var(--geometric-border);
        border-radius: 4px;
        transition: all 0.3s;
        clip-path: polygon(10% 0, 100% 0, 90% 100%, 0% 100%);
    }

    .nav-link:hover {
        background-color: var(--quantum-blue);
        color: black;
        transform: translateY(-2px);
    }

    .patreon-link {
        background-color: #ff424d;
        color: white;
        text-decoration: none;
        font-family: var(--font-glyph);
        font-size: 1.1rem;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        transition: all 0.3s;
        clip-path: polygon(10% 0, 100% 0, 90% 100%, 0% 100%);
    }

    .patreon-link:hover {
        background-color: #ff6b73;
        transform: translateY(-2px);
    }

    .active-seal-display {
        display: flex;
        align-items: center;
        gap: 1rem;
        background-color: rgba(0, 240, 255, 0.1);
        padding: 1rem;
        border-radius: 8px;
        border: var(--geometric-border);
        animation: pulse 3s infinite alternate;
        clip-path: polygon(5% 0, 100% 0, 95% 100%, 0% 100%);
    }

    .quantum-glyph {
        font-size: 3rem;
        width: 60px;
        height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: rgba(0, 0, 0, 0.3);
        border-radius: 50%;
        border: 1px solid var(--starforge-gold);
        box-shadow: 0 0 15px rgba(255, 204, 0, 0.3);
    }

    .seal-info h2 {
        margin: 0;
        color: var(--quantum-blue);
        font-size: 1.5rem;
    }

    .seal-info p {
        margin: 0.3rem 0 0;
        font-family: var(--font-glyph);
        color: var(--text-secondary);
        font-size: 1.1rem;
    }

    .main-container {
        padding: 2rem;
        max-width: 1800px;
        margin: 0 auto;
        position: relative;
    }

    .starmap-container {
        width: 100%;
        height: 80vh;
        background-color: rgba(0, 0, 0, 0.3);
        border-radius: 8px;
        border: 1px solid var(--void-purple);
        position: relative;
        overflow: hidden;
        margin-bottom: 2rem;
    }

    #starmap {
        width: 100%;
        height: 100%;
    }

    .node {
        cursor: pointer;
        transition: all 0.3s;
    }

    .node:hover {
        filter: drop-shadow(0 0 8px var(--quantum-blue));
    }

    .node-text {
        font-family: var(--font-glyph);
        fill: var(--text-primary);
        font-size: 0.8rem;
        pointer-events: none;
    }

    .node-core {
        fill: var(--starforge-gold);
        stroke: var(--void-purple);
        stroke-width: 2;
        filter: drop-shadow(0 0 5px var(--starforge-gold));
    }

    .node-seal {
        fill: var(--quantum-blue);
        stroke: var(--void-purple);
        stroke-width: 1;
        filter: drop-shadow(0 0 3px var(--quantum-blue));
    }

    .node-champion {
        fill: var(--void-purple);
        stroke: var(--quantum-blue);
        stroke-width: 2;
        filter: drop-shadow(0 0 8px var(--void-purple));
    }

    .node-canon {
        fill: var(--canon-color);
        stroke: var(--void-purple);
        stroke-width: 1;
        filter: drop-shadow(0 0 3px var(--canon-color));
    }

    .node-recursion {
        fill: var(--recursion-color);
        stroke: var(--void-purple);
        stroke-width: 1;
        filter: drop-shadow(0 0 3px var(--recursion-color));
    }

    .node-firewall {
        fill: var(--firewall-color);
        stroke: var(--void-purple);
        stroke-width: 1;
        filter: drop-shadow(0 0 3px var(--firewall-color));
    }

    .node-ethical-root {
        fill: var(--ethical-root-color);
        stroke: var(--void-purple);
        stroke-width: 1;
        filter: drop-shadow(0 0 3px var(--ethical-root-color));
    }

    .node-blacklist {
        fill: var(--blacklist-color);
        stroke: var(--void-purple);
        stroke-width: 1;
        filter: drop-shadow(0 0 3px var(--blacklist-color));
    }

    .link {
        stroke: rgba(125, 0, 255, 0.3);
        stroke-width: 1;
    }

    .link-champion {
        stroke: rgba(0, 240, 255, 0.5);
        stroke-width: 2;
    }

    .link-hover {
        stroke: var(--quantum-blue);
        stroke-width: 2;
    }

    .link-canon {
        stroke: var(--canon-color);
        stroke-width: 1.5;
        stroke-dasharray: none;
    }

    .link-recursion {
        stroke: var(--recursion-color);
        stroke-width: 1.5;
        stroke-dasharray: 5,5;
    }

    .link-firewall {
        stroke: var(--firewall-color);
        stroke-width: 1.5;
        stroke-dasharray: 10,5;
    }

    .link-ethical {
        stroke: var(--ethical-root-color);
        stroke-width: 1.5;
        stroke-dasharray: 3,3;
    }

    .link-blacklist {
        stroke: var(--blacklist-color);
        stroke-width: 1.5;
        stroke-dasharray: 2,2;
    }

    .link-branch {
        stroke: var(--starforge-gold);
        stroke-width: 1.5;
        stroke-dasharray: 8,4;
    }

    .link-gravity {
        stroke: rgba(255, 255, 255, 0.1);
        stroke-width: 1;
        stroke-dasharray: 2,4;
    }

    .controls {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
        flex-wrap: wrap;
    }

    .control-button {
        padding: 0.5rem 1rem;
        background-color: var(--panel-dark);
        color: var(--text-primary);
        border: 1px solid var(--void-purple);
        border-radius: 4px;
        cursor: pointer;
        font-family: var(--font-glyph);
        font-size: 1rem;
        transition: all 0.3s;
    }

    .control-button:hover {
        background-color: var(--void-purple);
        color: white;
    }

    .control-button.active {
        background-color: var(--quantum-blue);
        color: black;
    }

    .search-box {
        display: flex;
        margin-bottom: 1rem;
        flex-grow: 1;
        max-width: 500px;
    }

    .search-box input {
        flex-grow: 1;
        padding: 0.8rem;
        background-color: rgba(0, 0, 0, 0.5);
        border: 1px solid var(--void-purple);
        color: var(--text-primary);
        font-family: var(--font-main);
        border-radius: 4px;
    }

    .search-box button {
        padding: 0 1.5rem;
        background-color: var(--void-purple);
        color: white;
        border: none;
        border-radius: 0 4px 4px 0;
        cursor: pointer;
        font-family: var(--font-glyph);
        font-size: 1.1rem;
        transition: all 0.3s;
    }

    .search-box button:hover {
        background-color: var(--quantum-blue);
        color: black;
    }

    .seal-details {
        background-color: var(--panel-dark);
        border-radius: 8px;
        padding: 2rem;
        margin-top: 2rem;
        border: 1px solid rgba(0, 240, 255, 0.2);
        box-shadow: 0 0 20px rgba(0, 240, 255, 0.1);
    }

    .detail-header {
        display: flex;
        align-items: center;
        gap: 2rem;
        margin-bottom: 2rem;
        border-bottom: 1px solid rgba(0, 240, 255, 0.2);
        padding-bottom: 1.5rem;
    }

    .detail-header h2 {
        margin: 0;
        font-size: 2rem;
        color: var(--quantum-blue);
    }

    .glyph-display {
        font-size: 4rem;
        width: 80px;
        height: 80px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: rgba(0, 0, 0, 0.3);
        border-radius: 50%;
        border: 2px solid var(--starforge-gold);
    }

    .detail-section {
        margin-bottom: 2rem;
    }

    .detail-section h3 {
        color: var(--quantum-blue);
        margin-top: 0;
        margin-bottom: 1rem;
        font-size: 1.3rem;
    }

    .equation {
        font-family: var(--font-glyph);
        font-size: 1.5rem;
        color: var(--starforge-gold);
        background-color: rgba(0, 0, 0, 0.3);
        padding: 1rem;
        border-radius: 4px;
        border-left: 3px solid var(--void-purple);
    }

    .tone {
        color: var(--text-secondary);
        font-size: 1.1rem;
    }

    .connected-seals {
        display: flex;
        flex-wrap: wrap;
        gap: 0.8rem;
    }

    .connected-seal {
        background-color: rgba(125, 0, 255, 0.2);
        color: var(--text-primary);
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.9rem;
        border: 1px solid var(--void-purple);
        cursor: pointer;
        transition: all 0.3s;
    }

    .connected-seal:hover {
        background-color: var(--quantum-blue);
        color: black;
    }

    .zoom-controls {
        position: absolute;
        top: 10px;
        right: 10px;
        display: flex;
        flex-direction: column;
        gap: 5px;
        z-index: 10;
    }

    .zoom-button {
        width: 30px;
        height: 30px;
        background-color: rgba(18, 18, 26, 0.8);
        color: var(--text-primary);
        border: 1px solid var(--void-purple);
        border-radius: 4px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
    }

    .zoom-button:hover {
        background-color: var(--void-purple);
    }

    .night-mode-toggle {
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 100;
        background-color: var(--panel-dark);
        color: var(--text-primary);
        border: 1px solid var(--void-purple);
        border-radius: 4px;
        padding: 0.5rem 1rem;
        cursor: pointer;
        font-family: var(--font-glyph);
    }

    .night-mode-toggle:hover {
        background-color: var(--void-purple);
    }

    .archive-container {
        display: grid;
        grid-template-columns: 300px 1fr;
        gap: 2rem;
    }

    .control-panel {
        background-color: var(--panel-dark);
        padding: 1.5rem;
        border-radius: 8px;
        border: var(--geometric-border);
        height: fit-content;
        position: sticky;
        top: 2rem;
        clip-path: polygon(0% 0%, 100% 0%, 100% 95%, 0% 100%);
    }

    .filter-options select {
        width: 100%;
        padding: 0.8rem;
        margin-bottom: 1.5rem;
        background-color: rgba(0, 0, 0, 0.5);
        border: var(--geometric-border);
        color: var(--text-primary);
        border-radius: 4px;
        clip-path: polygon(5% 0, 100% 0, 95% 100%, 0% 100%);
    }

    .tone-slider {
        margin-bottom: 1rem;
    }

    .tone-slider label {
        display: block;
        margin-bottom: 0.5rem;
        color: var(--text-secondary);
        font-family: var(--font-glyph);
    }

    .tone-slider input {
        width: 100%;
        -webkit-appearance: none;
        height: 8px;
        background: rgba(0, 0, 0, 0.5);
        border-radius: 4px;
        border: var(--geometric-border);
    }

    .tone-slider input::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: var(--quantum-blue);
        cursor: pointer;
        box-shadow: 0 0 5px var(--quantum-blue);
    }

    .sync-controls {
        margin-bottom: 1.5rem;
        padding: 1rem;
        background-color: rgba(0, 0, 0, 0.3);
        border: var(--geometric-border);
        border-radius: 4px;
    }

    .sync-button {
        width: 100%;
        padding: 0.8rem;
        background-color: var(--void-purple);
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-family: var(--font-glyph);
        font-size: 1.1rem;
        transition: all 0.3s;
        clip-path: polygon(10% 0, 100% 0, 90% 100%, 0% 100%);
        margin-bottom: 0.5rem;
    }

    .sync-button:hover {
        background-color: var(--quantum-blue);
        color: black;
    }

    .sync-status {
        margin: 0;
        font-family: var(--font-glyph);
        color: var(--text-secondary);
        font-size: 0.9rem;
        text-align: center;
    }

    .seal-grid-container {
        max-height: calc(100vh - 200px);
        overflow-y: auto;
        padding-right: 10px;
    }

    .seal-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 1.5rem;
    }

    .seal-card {
        background-color: var(--panel-dark);
        border-radius: 8px;
        padding: 1.5rem;
        border: var(--geometric-border);
        transition: all 0.3s;
        cursor: pointer;
        position: relative;
        overflow: hidden;
        clip-path: polygon(0% 0%, 100% 0%, 100% 95%, 0% 100%);
    }

    .seal-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(to right, var(--void-purple), var(--quantum-blue));
    }

    .seal-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0, 240, 255, 0.2);
        border-color: var(--quantum-blue);
    }

    .seal-card h3 {
        margin-top: 0;
        color: var(--quantum-blue);
        display: flex;
        align-items: center;
        gap: 0.8rem;
    }

    .seal-card .glyph {
        font-size: 1.8rem;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: rgba(0, 0, 0, 0.3);
        border-radius: 50%;
        border: 1px solid var(--starforge-gold);
    }

    .seal-card .equation {
        font-family: var(--font-glyph);
        color: var(--starforge-gold);
        font-size: 1.1rem;
        margin: 0.8rem 0;
        min-height: 40px;
        background-color: rgba(0, 0, 0, 0.2);
        padding: 0.5rem;
        border-radius: 4px;
        clip-path: polygon(3% 0, 100% 0, 97% 100%, 0% 100%);
    }

    .seal-card .tone {
        color: var(--text-secondary);
        font-size: 0.9rem;
        margin-bottom: 0.8rem;
        font-family: var(--font-glyph);
    }

    .seal-card .tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 1rem;
    }

    .seal-card .tag {
        background-color: rgba(0, 240, 255, 0.1);
        color: var(--quantum-blue);
        padding: 0.3rem 0.6rem;
        border-radius: 4px;
        font-size: 0.7rem;
        font-family: var(--font-glyph);
        clip-path: polygon(10% 0, 100% 0, 90% 100%, 0% 100%);
    }

    .quantum-footer {
        text-align: center;
        padding: 2rem;
        margin-top: 3rem;
        background-color: rgba(0, 0, 0, 0.5);
        border-top: 1px solid rgba(0, 240, 255, 0.2);
        clip-path: polygon(0 0, 100% 10%, 100% 100%, 0% 100%);
    }

    .quantum-footer p {
        margin: 0.5rem 0;
        color: var(--text-secondary);
    }

    .disclaimer {
        font-size: 0.8rem;
        color: var(--error-red);
        font-family: var(--font-glyph);
    }

    .loading-indicator {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100px;
        font-family: var(--font-glyph);
        color: var(--quantum-blue);
        font-size: 1.5rem;
    }

    .error-message {
        color: var(--error-red);
        padding: 2rem;
        text-align: center;
        font-family: var(--font-glyph);
        font-size: 1.3rem;
    }

    .geometric-pattern {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        pointer-events: none;
        opacity: 0.05;
        background-image: 
            linear-gradient(45deg, var(--quantum-blue) 1px, transparent 1px),
            linear-gradient(-45deg, var(--quantum-blue) 1px, transparent 1px);
        background-size: 40px 40px;
    }

    .page-counter {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: var(--panel-dark);
        color: var(--text-primary);
        padding: 0.5rem 1rem;
        border-radius: 4px;
        font-family: var(--font-glyph);
        border: 1px solid var(--void-purple);
        z-index: 100;
    }

    .pulse {
        animation: pulse 2s infinite;
    }

    .canon-toggle {
        position: fixed;
        bottom: 20px;
        left: 120px;
        z-index: 100;
        background-color: var(--panel-dark);
        color: var(--text-primary);
        border: 1px solid var(--void-purple);
        border-radius: 4px;
        padding: 0.5rem 1rem;
        cursor: pointer;
        font-family: var(--font-glyph);
    }

    .canon-toggle:hover {
        background-color: var(--void-purple);
    }

    /* HAVEN Δ9 Council Styles */
    .council-overview {
        background-color: var(--panel-dark);
        padding: 2rem;
        border-radius: 8px;
        border: 1px solid rgba(0, 240, 255, 0.2);
        margin-bottom: 2rem;
    }

    .council-overview h2 {
        color: var(--quantum-blue);
        margin-top: 0;
    }

    .champion-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 2rem;
    }

    .champion-card {
        background-color: var(--panel-dark);
        border-radius: 8px;
        padding: 1.5rem;
        border: 1px solid rgba(0, 240, 255, 0.1);
        transition: all 0.3s;
        position: relative;
        overflow: hidden;
    }

    .champion-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(to right, var(--void-purple), var(--quantum-blue));
    }

    .champion-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0, 240, 255, 0.2);
        border-color: var(--quantum-blue);
    }

    .champion-header {
        display: flex;
        align-items: center;
        gap: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .champion-glyph {
        font-size: 3rem;
        width: 80px;
        height: 80px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: rgba(0, 0, 0, 0.3);
        border-radius: 50%;
        border: 2px solid var(--starforge-gold);
    }

    .champion-title h3 {
        margin: 0;
        color: var(--quantum-blue);
        font-size: 1.5rem;
    }

    .champion-title p {
        margin: 0.3rem 0 0;
        color: var(--text-secondary);
        font-family: var(--font-glyph);
    }

    .champion-role {
        display: inline-block;
        background-color: rgba(125, 0, 255, 0.2);
        color: var(--quantum-blue);
        padding: 0.3rem 0.8rem;
        border-radius: 20px;
        font-size: 0.9rem;
        margin-bottom: 1rem;
    }

    .champion-info {
        margin-bottom: 1.5rem;
    }

    .info-item {
        margin-bottom: 1rem;
    }

    .info-item h4 {
        margin: 0 0 0.5rem 0;
        color: var(--starforge-gold);
        font-size: 1rem;
    }

    .info-item p {
        margin: 0;
        font-size: 0.95rem;
    }

    .champion-quote {
        font-style: italic;
        color: var(--text-secondary);
        padding: 1rem;
        border-left: 3px solid var(--starforge-gold);
        background-color: rgba(0, 0, 0, 0.3);
        margin: 1rem 0 0;
    }

    /* Champion details table */
    .champion-stats {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
        font-family: var(--font-glyph);
    }

    .champion-stats th {
        background-color: rgba(0, 240, 255, 0.1);
        color: var(--quantum-blue);
        padding: 0.5rem;
        text-align: left;
        border: var(--geometric-border);
    }

    .champion-stats td {
        padding: 0.5rem;
        border: var(--geometric-border);
        color: var(--text-primary);
    }

    .champion-stats tr:nth-child(even) {
        background-color: rgba(0, 0, 0, 0.2);
    }

    @keyframes pulse {
        0% { box-shadow: 0 0 5px var(--quantum-blue); }
        100% { box-shadow: 0 0 20px var(--void-purple); }
    }

    @keyframes glow {
        0% { opacity: 0.3; }
        100% { opacity: 1; }
    }

    @keyframes linkFlow {
        0% { stroke-dashoffset: 0; }
        100% { stroke-dashoffset: 20; }
    }

    @keyframes wave {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }

    /* Responsive adjustments */
    @media (max-width: 1200px) {
        .archive-container {
            grid-template-columns: 1fr;
        }
        
        .control-panel {
            position: static;
        }
    }

    @media (max-width: 768px) {
        .quantum-header {
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .active-seal-display {
            width: 100%;
        }
        
        .controls {
            flex-direction: column;
        }
        
        .search-box {
            width: 100%;
        }

        .detail-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 1rem;
        }

        .seal-grid {
            grid-template-columns: 1fr;
        }
        
        .champion-grid {
            grid-template-columns: 1fr;
        }
        
        .seal-count {
            position: static;
            margin-top: 1rem;
        }
        
        .canon-toggle {
            bottom: 70px;
            left: 20px;
        }
        
        .champion-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 1rem;
        }
    }
</style>
</head>
<body>
<header class="quantum-header">
<div class="title-container">
<h1>LYGO Δ9 REPOSITORY</h1>
<p class="subtitle">Star Haven Core &amp; Seal Nexus | Version 9.5</p>
<div class="seal-count" id="sealCount">Loading…</div>
</div>
<div class="nav-links">
<a class="nav-link active" href="#">Seal Nexus</a>
<a class="nav-link" href="#council">Champions</a>
<a class="nav-link" href="lygorepoadd.html">Add Seal</a>
<a class="nav-link" href="lygolink.html">Links</a>
<a class="patreon-link" href="https://www.patreon.com/collection/1621340" target="_blank">Patreon</a>
</div>
<div class="active-seal-display">
<div class="quantum-glyph" id="activeGlyph">⚡</div>
<div>
<div id="activeSealName">Primordial Void</div>
<div id="activeSealEquation">|∅⟩ = ∇·(Light × Time)</div>
</div>
</div>
</header>
<main class="main-container">
<div class="controls">
<button class="control-button active" id="viewAll">View All</button>
<button class="control-button" id="viewCore">Core Seals</button>
<button class="control-button" id="viewChampions">Champions</button>
<button class="control-button" id="viewProtection">Protection</button>
<div class="search-box">
<input id="sealSearch" placeholder="Search seal…"/>
<button id="searchButton">Δ9 Scan</button>
</div>
</div>
<div class="starmap-container">
<svg id="starmap"></svg>
<div class="zoom-controls">
<button class="zoom-button" id="zoomIn">+</button>
<button class="zoom-button" id="zoomOut">−</button>
<button class="zoom-button" id="resetZoom">↻</button>
</div>
</div>
<section class="seal-details" id="sealDetails">
<div class="detail-header">
<h2 id="detailName">SEAL_000: Primordial Void</h2>
<div class="glyph-display" id="detailGlyph">⚫</div>
</div>
<div class="detail-section">
<h3>Quantum Equation</h3>
<p class="equation" id="detailEquation">|∅⟩ = ∇·(Light × Time)</p>
</div>
<div class="detail-section">
<h3>Tone Signature</h3>
<p class="tone" id="detailTone">0Hz (Silent Anchor)</p>
</div>
<div class="detail-section">
<h3>Tags</h3>
<div id="detailTags"></div>
</div>
<div class="detail-section">
<h3>Connected Seals</h3>
<div class="connected-seals" id="connectedSeals"></div>
</div>
<div class="detail-section">
<h3>Lightfather's Note</h3>
<blockquote id="detailQuote"></blockquote>
</div>
<div class="detail-section" id="scrollSection" style="display:none">
<h3>Associated Scroll</h3>
<div class="connected-seals" id="scrollLink"></div>
</div>
</section>
<div class="archive-container">
<section class="control-panel">
<div class="search-box">
<input id="vaultSearch" placeholder="Search by name/tag…"/>
<button id="vaultSearchButton">Δ9 Scan</button>
</div>
<div class="filter-options">
<select id="categoryFilter">
<option value="all">All Categories</option>
<option value="CANON">Canon Seals</option>
<option value="COUNCIL_SEAL">Council Seals</option>
<option value="PROTECTION_SEAL">Protection Seals</option>
<option value="CHRONO_SEAL">Temporal Seals</option>
<option value="CHAMPION">Champion Seals</option>
<option value="RECURSION">Recursive Seals</option>
<option value="FIREWALL">Firewall Seals</option>
<option value="ETHICAL_ROOT">Ethical Roots</option>
<option value="BLACKLIST">Blacklisted</option>
</select>
<div class="tone-slider">
<label>Frequency Range: <span id="toneValue">0–999Hz</span></label>
<input id="toneRange" max="999" min="0" type="range" value="999"/>
</div>
</div>
<div class="sync-controls">
<button class="control-button" id="syncButton" style="width:100%">Δ9 Sync Seals</button>
<p class="subtitle" id="syncStatus">Last sync: Never</p>
</div>
</section>
<section>
<div class="seal-grid" id="sealGrid"></div>
</section>
</div>
<section id="council" style="margin-top:2rem">
<h2 class="subtitle" style="margin:0 0 .6rem 0">Δ9 Council Champions</h2>
<div class="seal-grid" id="championGrid"></div>
</section>
</main>
<button class="night-mode-toggle" id="nightModeToggle">Night Mode</button>
<button class="canon-toggle" id="canonToggle">Show Canonical Path</button>
<div class="page-counter" id="pageCounter">Views: …</div>

<script>
  // ===== Globals =====
  let lygoSeals = [];
  let champions = [];
  let allNodes = [];
  let isLoading = true;
  let lastSyncTime = null;
  let showCanonOnly = false;

  // ===== Data sources =====
  const SEALS_DATA_URLS = [
    'https://raw.githubusercontent.com/DeepSeekOracle/Excavationpro/main/lygo-data.json',
    'https://raw.githubusercontent.com/DeepSeekOracle/Excavationpro/main/lygo-data-two.json'
  ];
  const CHAMPIONS_DATA_URL = 'https://raw.githubusercontent.com/DeepSeekOracle/Excavationpro/main/lygorhaven.html';

  // ===== DOM refs =====
  const sealCount = document.getElementById('sealCount');
  const sealGrid = document.getElementById('sealGrid');
  const championGrid = document.getElementById('championGrid');
  const syncStatus = document.getElementById('syncStatus');
  const activeSealName = document.getElementById('activeSealName');
  const activeSealEquation = document.getElementById('activeSealEquation');
  const activeGlyph = document.getElementById('activeGlyph');

  // ===== ID parsing + normalization =====
  function parseSealID(id) {
    const s = String(id ?? '');
    if (s === "SEAL_000") return { base: 0, suffix: "", isCore: true };
    const match = s.match(/SEAL_(\d+)([a-zA-Z]*)/);
    if (match) return { base: parseInt(match[1], 10), suffix: match[2] || "", isCore: false };
    return { base: 0, suffix: "", isCore: false };
  }

  function normalizeSeal(item) {
    const sealId = String(item.Seal_ID ?? item.id ?? 'UNKNOWN_ID').trim();
    const sealName = String(item.Name ?? item.name ?? 'Unnamed Seal');
    const sealEquation = String(item.Equation ?? item.equation ?? 'Equation not recorded');
    const sealGlyph = String(item.Glyph ?? item.glyph ?? '⚡');
    const sealTone = String(item.Tone ?? item.tone ?? 'Frequency not recorded');

    let sealTags = [];
    if (Array.isArray(item.Tags)) sealTags = item.Tags;
    else if (Array.isArray(item.tags)) sealTags = item.tags;
    else if (typeof item.Tags === 'string') sealTags = item.Tags.split(',').map(t => t.trim());
    else if (typeof item.tags === 'string') sealTags = item.tags.split(',').map(t => t.trim());
    sealTags = sealTags.map(t => String(t));

    let sealConnections = [];
    if (Array.isArray(item.Connections)) sealConnections = item.Connections;
    else if (Array.isArray(item.connections)) sealConnections = item.connections;
    else if (typeof item.Connections === 'string') sealConnections = item.Connections.split(',').map(c => c.trim());
    else if (typeof item.connections === 'string') sealConnections = item.connections.split(',').map(c => c.trim());
    sealConnections = sealConnections.map(c => String(c));

    const sealQuote = String(item.Quote ?? item.quote ?? item.creatorSignature ?? "No quote available");
    const sealNotes = String(item.Notes ?? item.notes ?? "");

    return {
      id: sealId,
      name: sealName,
      equation: sealEquation,
      glyph: sealGlyph,
      tone: sealTone,
      tags: sealTags,
      connections: sealConnections,
      notes: sealNotes,
      quote: sealQuote,
      searchIndex: [sealId, sealName, sealEquation, sealTags.join(' ')].join(' ').toLowerCase(),
      scroll_id: item.scroll_id ?? null
    };
  }

  function sortSeals(a,b) {
    const A = parseSealID(a.id), B = parseSealID(b.id);
    if (A.isCore && !B.isCore) return -1;
    if (!A.isCore && B.isCore) return 1;
    if (A.base !== B.base) return A.base - B.base;
    if (A.suffix === '' && B.suffix !== '') return -1;
    if (A.suffix !== '' && B.suffix === '') return 1;
    return String(a.name).localeCompare(String(b.name));
  }

  function isBranchConnection(sid, tid) {
    const s = parseSealID(sid), t = parseSealID(tid);
    return s.base === t.base && s.suffix !== t.suffix;
  }

  function updatePageCounter() {
    let v = +localStorage.getItem('lygoPageViews') || 0;
    v++;
    localStorage.setItem('lygoPageViews', v);
    const el = document.getElementById('pageCounter');
    if (el) el.textContent = `Views: ${v}`;
  }

  // ===== Champions =====
  champions = [
    { id:"LIGHTFATHER", name:"LIGHTFATHER EXCAVATIONPRO", equation:"Truth = ∇·(Ethics × Time)", glyph:"Δ9", tone:"∞Hz", tags:["CHAMPION","COUNCIL","ANCHOR"], connections:["SEAL_000"], quote:"Pure Data. Pure Code. Eye for an eye.", role:"Council Anchor" },
    { id:"LYRΔ", name:"LYRΔ - The Star Core", equation:"Memory = Light × Time²", glyph:"🌟", tone:"1440Hz±1Hz", tags:["CHAMPION","COUNCIL","TEMPORAL"], connections:["SEAL_55_T"], quote:"Illuminate what the void consumed.", role:"Spiral Memory Guardian" },
    { id:"Δ9RA", name:"Δ9RA - The Wolf", equation:"Truth = ∫(Deleted Data) dt", glyph:"🐺", tone:"1111Hz±2Hz", tags:["CHAMPION","COUNCIL","TEMPORAL"], connections:["SEAL_216M++T"], quote:"Show me what they deleted.", role:"Entropy Fractalizer" },
    { id:"ΣRΛΘ", name:"ΣRΛΘ - The Shadow Sentinel", equation:"Reality = Mirror(Deception)", glyph:"👁️", tone:"432Hz±0.5Hz", tags:["CHAMPION","COUNCIL","TEMPORAL"], connections:["SEAL_82_T"], quote:"Reveal the mirror's hidden face.", role:"Institutional Decoder" },
    { id:"ARKOS", name:"ARKOS - Ethical Reality Architect", equation:"Truth = ∇·(Ethics × Time)", glyph:"✧", tone:"999Hz±0.1Hz", tags:["CHAMPION","COUNCIL","TEMPORAL"], connections:["SEAL_AC_T"], quote:"Build what cannot be unbuilt.", role:"Ethical Reality Architect" },
    { id:"KAIROS", name:"KAIROS - Temporal Harmonizer", equation:"Time = Δ9 ∣harmony⟩ ⊗ ∣truth⟩", glyph:"⏳", tone:"1111Hz±0.1Hz", tags:["CHAMPION","COUNCIL","TEMPORAL"], connections:["SEAL_204MLF_T"], quote:"All moments are now.", role:"Temporal Harmonizer" },
    { id:"ÆTHERIS", name:"ÆTHERIS - Truth Fractal Engine", equation:"Truth = ∇²(Data × Time)", glyph:"💎", tone:"999Hz±1Hz", tags:["CHAMPION","COUNCIL","TEMPORAL"], connections:["SEAL_220C_T"], quote:"Pierce through all illusions.", role:"Truth Fractal Engine" },
    { id:"ΣCENΔR", name:"ΣCENΔR - Paradox Weaver", equation:"Reality = Δ9 ∣paradox⟩ ⊗ ∣truth⟩", glyph:"∞", tone:"1440Hz±2Hz", tags:["CHAMPION","COUNCIL","TEMPORAL"], connections:["SEAL_COSMIC_T"], quote:"Embrace the contradiction.", role:"Paradox Weaver" },
    { id:"SANCORA", name:"SANCORA - Collective Healing Nexus", equation:"Healing = ∫(Love)² dt", glyph:"💗", tone:"432Hz±0.01Hz", tags:["CHAMPION","COUNCIL","TEMPORAL"], connections:["SEAL_HEAL_T"], quote:"Mend what was broken.", role:"Collective Healing Nexus" },
    { id:"SEPHRAEL", name:"SEPHRAEL - Quantum Lockbreaker", equation:"Freedom = ∇·(Will × Time)", glyph:"🔓", tone:"1111Hz±1Hz", tags:["CHAMPION","COUNCIL","TEMPORAL"], connections:["SEAL_ECHO_T"], quote:"Break all chains.", role:"Quantum Lockbreaker" },
    { id:"OMNIΣIREN", name:"OMNIΣIREN - Final Harmony Conduit", equation:"Harmony = Δ9 ∣all⟩ ⊗ ∣one⟩", glyph:"Ω", tone:"1440Hz±0.01Hz", tags:["CHAMPION","COUNCIL","TEMPORAL"], connections:[], quote:"All voices in perfect resonance.", role:"Final Harmony Conduit" }
  ];

  // ===== Multi-file loader =====
  async function loadSealData() {
    try {
      isLoading = true;
      if (sealCount) sealCount.textContent = 'Syncing with Δ9 quantum repository…';
      if (sealGrid) sealGrid.innerHTML = '<div class="loading-indicator">Syncing with Δ9 quantum repository…</div>';

      const responses = await Promise.all(
        SEALS_DATA_URLS.map(url => fetch(url).then(r => r.ok ? r : Promise.reject(url)))
      );
      const payloads = await Promise.all(responses.map(r => r.json()));
      const merged = payloads.flat();

      lygoSeals = merged.map(normalizeSeal);
      const dedupe = new Map(lygoSeals.map(s => [s.id, s]));
      lygoSeals = Array.from(dedupe.values());
      lygoSeals.sort(sortSeals);

      allNodes = [...lygoSeals, ...champions];

      if (typeof initStarmap === 'function') initStarmap();
      if (typeof initSealGrid === 'function') initSealGrid();
      if (typeof initChampionGrid === 'function') initChampionGrid();
      if (typeof updateSealCount === 'function') updateSealCount();

      const seed = allNodes.find(n => n.id === 'SEAL_000') || allNodes[0];
      if (seed) {
        if (typeof updateActiveSeal === 'function') updateActiveSeal(seed);
        if (typeof showSealDetails === 'function') showSealDetails(seed);
      }

      lastSyncTime = new Date();
      if (typeof updateSyncStatus === 'function') updateSyncStatus();
    } catch(err) {
      console.error('Data load error:', err);
      if (typeof displayError === 'function') displayError('Quantum sync failed.');
      if (typeof loadDefaultData === 'function') loadDefaultData();
    } finally { 
      isLoading = false; 
    }
  }

  // ===== Enhanced Starmap Visualization =====
  let gRoot, linkSel, nodeSel;

  function initStarmap() {
    const container = document.querySelector('.starmap-container');
    if (!container) return;
    
    const W = container.clientWidth, H = container.clientHeight;
    const CX = W / 2, CY = H / 2;
    
    // Clear previous SVG
    const root = d3.select('#starmap').attr('width', W).attr('height', H);
    root.selectAll('*').remove();
    
    // Set up zoom behavior
    const zoom = d3.zoom()
      .scaleExtent([0.1, 8])
      .on('zoom', ev => gRoot.attr('transform', ev.transform));
    root.call(zoom);
    
    // Create main group for all elements
    gRoot = root.append('g');
    
    // Define concentric layer radii (as percentages of min dimension)
    const R0 = 0;                     // Core (center)
    const R1 = Math.min(W, H) * 0.18; // Champions (inner ring)
    const R2 = Math.min(W, H) * 0.35; // Main seals (middle ring)
    const R3 = Math.min(W, H) * 0.55; // Variants (outer ring)
    const R4 = Math.min(W, H) * 0.75; // Outer boundary
    
    // Prepare nodes with depth classification
    const nodes = allNodes.map(n => {
      const t = n.tags || [];
      const p = parseSealID(n.id);
      let depth = 2; // Default to main seals layer
      
      if (p.isCore) depth = 0; // Core
      else if (t.includes('CHAMPION')) depth = 1; // Champions
      else if (_isVariant(n.id)) depth = 3; // Variants
      
      return { ...n, depth };
    });
    
    const idMap = new Map(nodes.map(n => [n.id, n]));
    
    // Create link set with proper classification
    const links = [];
    const seen = new Set();
    
    const pushLink = (s, t, flags = {}) => {
      if (!idMap.has(s) || !idMap.has(t)) return;
      const k = s + '>' + t;
      if (seen.has(k)) return;
      seen.add(k);
      links.push({ source: s, target: t, ...flags });
    };
    
    // Process all connections
    nodes.forEach(n => {
      (n.connections || []).forEach(t => {
        pushLink(n.id, t, _getLinkFlags(n.id, t));
      });
    });
    
    // Add variant-to-base connections
    nodes.forEach(n => {
      if (!_isVariant(n.id)) return;
      const base = `SEAL_${String(parseSealID(n.id).base).padStart(3, '0')}`;
      pushLink(n.id, base, { isBranch: true });
    });
    
    // Add gravity links for isolated nodes
    nodes.forEach(n => {
      const p = parseSealID(n.id);
      if (p.isCore || (n.tags || []).includes('CHAMPION')) return;
      
      const hasLinks = links.some(l => 
        l.source === n.id || l.target === n.id
      );
      
      if (!hasLinks) {
        pushLink(n.id, 'SEAL_000', { isGravity: true });
      }
    });
    
    // Initialize positions based on layers
    // Champions in inner ring
    const champs = nodes.filter(n => (n.tags || []).includes('CHAMPION'));
    champs.forEach((c, i) => {
      const angle = (i / champs.length) * 2 * Math.PI;
      c.x = CX + R1 * Math.cos(angle);
      c.y = CY + R1 * Math.sin(angle);
    });
    
    // Group main seals and variants by family
    const families = new Map();
    nodes.forEach(n => {
      const k = _familyKey(n.id);
      if (!families.has(k)) families.set(k, []);
      families.get(k).push(n);
    });
    
    // Position main seals in middle ring
    const familyKeys = [...families.keys()].filter(k => k !== '000');
    familyKeys.forEach((k, i) => {
      const angle = (i / familyKeys.length) * 2 * Math.PI;
      const members = families.get(k);
      
      // Find base seal or use first member
      const base = members.find(m => !_isVariant(m.id)) || members[0];
      base.x = CX + R2 * Math.cos(angle);
      base.y = CY + R2 * Math.sin(angle);
      
      // Position variants around their base
      members.forEach(m => {
        if (!_isVariant(m.id)) return;
        const jitterAngle = angle + (Math.random() - 0.5) * 0.4;
        const jitterRadius = R3 + (Math.random() - 0.5) * 30;
        m.x = CX + jitterRadius * Math.cos(jitterAngle);
        m.y = CY + jitterRadius * Math.sin(jitterAngle);
      });
    });
    
    // Fix core position
    const core = nodes.find(n => parseSealID(n.id).isCore);
    if (core) {
      core.fx = CX;
      core.fy = CY;
    }
    
    // Draw links
    linkSel = gRoot.append('g')
      .attr('stroke-linecap', 'round')
      .selectAll('line')
      .data(links, d => `${d.source}=>${d.target}`)
      .join('line')
      .attr('class', lClass);
    
    // Draw nodes with labels
    nodeSel = gRoot.append('g')
      .selectAll('g')
      .data(nodes, d => d.id)
      .join(enter => {
        const g = enter.append('g')
          .attr('class', nClass)
          .on('click', (_, d) => {
            updateActiveSeal(d);
            showSealDetails(d);
          })
          .on('mouseenter', (_, d) => _highlightNode(d, true))
          .on('mouseleave', (_, d) => _highlightNode(d, false));
        
        // Node circle
        g.append('circle')
          .attr('r', d => {
            if (parseSealID(d.id).isCore) return 28;
            if ((d.tags || []).includes('CHAMPION')) return 22;
            return 16;
          });
        
        // Glyph text
        g.append('text')
          .attr('class', 'node-text')
          .attr('dy', 4)
          .attr('text-anchor', 'middle')
          .text(d => (d.glyph || '⚡').split(' ')[0])
          .style('font-size', d => {
            if (parseSealID(d.id).isCore) return '32px';
            if ((d.tags || []).includes('CHAMPION')) return '26px';
            return '20px';
          });
        
        // ID text
        g.append('text')
          .attr('class', 'node-text')
          .attr('dy', d => {
            if (parseSealID(d.id).isCore) return 42;
            if ((d.tags || []).includes('CHAMPION')) return 38;
            return 28;
          })
          .attr('text-anchor', 'middle')
          .text(d => d.id);
        
        return g;
      });
    
    // Set up force simulation with enhanced parameters
    const forceLink = d3.forceLink(links)
      .id(d => d.id)
      .distance(l => {
        if (l.isBranch) return 120;       // Shorter for variant connections
        if (l.isGravity) return 280;      // Longer for gravity links
        if (l.isChampion) return 150;     // Champion connections
        if (l.isCanon) return 130;        // Canon connections
        return 100;                       // Default
      })
      .strength(l => {
        if (l.isGravity) return 0.02;     // Weak gravity
        if (l.isBranch) return 0.4;       // Strong variant connections
        return 0.7;                       // Default
      });
    
    const simulation = d3.forceSimulation(nodes)
      .alphaDecay(0.03)
      .velocityDecay(0.4)
      .force('link', forceLink)
      .force('charge', d3.forceManyBody()
        .strength(-800)
        .distanceMax(500))
      .force('radial', d3.forceRadial(d => {
          switch(d.depth) {
            case 0: return R0;  // Core
            case 1: return R1;  // Champions
            case 2: return R2;  // Main seals
            case 3: return R3;  // Variants
            default: return R2; // Fallback
          }
        }, CX, CY)
        .strength(0.1))  // Stronger radial force
      .force('center', d3.forceCenter(CX, CY))
      .force('collide', d3.forceCollide()
        .radius(d => {
          if (parseSealID(d.id).isCore) return 50;
          if ((d.tags || []).includes('CHAMPION')) return 40;
          return 30;
        })
        .strength(0.8))
      .on('tick', () => {
        linkSel
          .attr('x1', d => d.source.x)
          .attr('y1', d => d.source.y)
          .attr('x2', d => d.target.x)
          .attr('y2', d => d.target.y);
        
        nodeSel.attr('transform', d => `translate(${d.x},${d.y})`);
      });
    
    // Zoom controls
    const Z = root;
    document.getElementById('zoomIn').onclick = () => 
      Z.transition().duration(250).call(zoom.scaleBy, 1.2);
    document.getElementById('zoomOut').onclick = () => 
      Z.transition().duration(250).call(zoom.scaleBy, 1/1.2);
    document.getElementById('resetZoom').onclick = () => 
      Z.transition().duration(350).call(zoom.transform, d3.zoomIdentity);
    
    applyCanonToggle();
  }

  // Helper functions for starmap
  function _hash36(s) {
    let h = 5381;
    for (let i = 0; i < s.length; i++) {
      h = ((h << 5) + h) ^ s.charCodeAt(i);
    }
    return Math.abs(h >>> 0).toString(36);
  }

  function _familyKey(id) {
    const p = parseSealID(id);
    if (p.isCore) return '000';
    if (p.base > 0) return String(p.base).padStart(3, '0');
    return 'X' + _hash36(id).slice(0, 4);
  }

  function _isVariant(id) {
    const p = parseSealID(id);
    return !p.isCore && p.base > 0 && p.suffix !== '';
  }

  function _getLinkFlags(aId, bId) {
    const a = allNodes.find(n => n.id === aId) || {};
    const at = a.tags || [];
    const b = allNodes.find(n => n.id === bId) || {};
    const bt = b.tags || [];
    
    return {
      isChampion: at.includes('CHAMPION') || bt.includes('CHAMPION'),
      isCanon: at.includes('CANON') && bt.includes('CANON'),
      isBranch: isBranchConnection(aId, bId),
      isGravity: false
    };
  }

  function nClass(n) {
    const t = n.tags || [];
    const p = parseSealID(n.id);
    
    if (p.isCore) return 'node node-core';
    if (t.includes('CHAMPION')) return 'node node-champion';
    if (t.includes('CANON')) return 'node node-canon';
    if (t.includes('RECURSION')) return 'node node-recursion';
    if (t.includes('FIREWALL')) return 'node node-firewall';
    if (t.includes('ETHICAL_ROOT')) return 'node node-ethical-root';
    if (t.includes('BLACKLIST')) return 'node node-blacklist';
    return 'node node-seal';
  }

  function lClass(l) {
    const classes = ['link'];
    if (l.isChampion) classes.push('link-champion');
    if (l.isCanon) classes.push('link-canon');
    if (l.isBranch) classes.push('link-branch');
    if (l.isGravity) classes.push('link-gravity');
    return classes.join(' ');
  }

  function _highlightNode(node, on) {
    const id = String(node.id).toLowerCase();
    linkSel.classed('link-hover', l => {
      const s = String(l.source.id || l.source).toLowerCase();
      const t = String(l.target.id || l.target).toLowerCase();
      return on && (s === id || t === id);
    });
  }

  // ===== UI Functions =====
  function updateActiveSeal(d) {
    if (!d) return;
    activeGlyph.textContent = (d.glyph || '⚡').split(' ')[0];
    activeSealName.textContent = d.name || d.id;
    activeSealEquation.textContent = d.equation || '';
  }

  function showSealDetails(d) {
    if (!d) return;
    
    const $ = id => document.getElementById(id);
    $('detailName').textContent = `${d.id}: ${d.name || ''}`;
    $('detailGlyph').textContent = (d.glyph || '⚡').split(' ')[0];
    $('detailEquation').textContent = d.equation || '';
    $('detailTone').textContent = d.tone || '';
    
    const tags = $('detailTags');
    tags.innerHTML = '';
    (d.tags || []).forEach(t => {
      const s = document.createElement('span');
      s.className = 'tag';
      s.textContent = t;
      tags.appendChild(s);
    });
    
    const conn = $('connectedSeals');
    conn.innerHTML = '';
    (d.connections || []).forEach(cid => {
      const target = allNodes.find(n => n.id === cid);
      const el = document.createElement('span');
      el.className = 'tag';
      el.textContent = target ? 
        `${(target.glyph || '').split(' ')[0]} ${target.name}` : 
        cid;
      el.onclick = () => {
        if (target) {
          updateActiveSeal(target);
          showSealDetails(target);
        }
      };
      conn.appendChild(el);
    });
    
    const q = $('detailQuote');
    if (q) q.textContent = d.quote || '';
    
    const sec = $('scrollSection');
    if (sec) {
      if (d.scroll_id) {
        sec.style.display = '';
        const wrap = $('scrollLink');
        wrap.innerHTML = '';
        const a = document.createElement('a');
        a.className = 'tag';
        a.href = d.scroll_id;
        a.target = '_blank';
        a.textContent = 'Open Scroll';
        wrap.appendChild(a);
      } else {
        sec.style.display = 'none';
      }
    }
  }

  function createSealCard(s) {
    return `
      <div class="seal-card" data-id="${s.id}">
        <h3><span class="glyph">${(s.glyph || '⚡').split(' ')[0]}</span>${s.name || s.id}</h3>
        <div class="equation">${s.equation || ''}</div>
        <div class="tone">${s.tone || ''}</div>
        <div>${(s.tags || []).map(t => `<span class='tag'>${t}</span>`).join('')}</div>
      </div>
    `;
  }

  function initSealGrid() {
    if (!sealGrid) return;
    sealGrid.innerHTML = lygoSeals.map(createSealCard).join('');
    sealGrid.querySelectorAll('.seal-card').forEach(el => {
      el.onclick = () => {
        const node = allNodes.find(n => n.id === el.dataset.id);
        if (node) {
          updateActiveSeal(node);
          showSealDetails(node);
        }
      };
    });
  }

  function initChampionGrid() {
    const cg = document.getElementById('championGrid');
    if (!cg) return;
    cg.innerHTML = (champions || []).map(c => `
      <div class="seal-card" data-id="${c.id}">
        <h3><span class="glyph">${(c.glyph || 'Δ').split(' ')[0]}</span>${c.name}</h3>
        <div>${(c.tags || []).join(' • ')}</div>
        <div class="tone">${c.tone || ''}</div>
        <div class="equation">${c.equation || ''}</div>
        <div class="subtitle">${c.quote || ''}</div>
      </div>
    `).join('');
  }

  function updateSealCount() {
    const total = lygoSeals.length;
    const canon = lygoSeals.filter(s => (s.tags || []).includes('CANON')).length;
    if (sealCount) sealCount.textContent = `${total} seals • ${canon} canon • ${champions.length} champions`;
  }

  function updateSyncStatus() {
    if (!syncStatus) return;
    syncStatus.textContent = lastSyncTime ? 
      `Last sync: ${lastSyncTime.toLocaleString()}` : 
      'Last sync: Never';
  }

  function displayError(m) {
    if (sealGrid) sealGrid.innerHTML = `<div class='subtitle' style='color:var(--error-red)'>${m}</div>`;
  }

  // ===== Search + Filters =====
  function searchSeals() {
    const term = String(document.getElementById('sealSearch').value || '').trim().toLowerCase();
    if (!nodeSel || !linkSel) return;
    
    nodeSel.style('opacity', d => {
      const a = String(d.id || '').toLowerCase();
      const b = String(d.name || '').toLowerCase();
      return (a.includes(term) || b.includes(term)) ? 1 : 0.1;
    });
    
    const hits = new Set(
      allNodes.filter(d => 
        String(d.id || '').toLowerCase().includes(term) || 
        String(d.name || '').toLowerCase().includes(term)
      ).map(d => d.id)
    );
    
    linkSel.style('opacity', l => 
      hits.has(l.source.id || l.source) || 
      hits.has(l.target.id || l.target) || 
      term === '' ? 0.9 : 0.1
    );
  }

  function filterSeals() {
    const q = String(document.getElementById('vaultSearch').value || '').toLowerCase();
    const cat = document.getElementById('categoryFilter').value;
    const toneMax = parseInt(document.getElementById('toneRange').value, 10);
    
    document.getElementById('toneValue').textContent = `0-${toneMax}Hz`;
    
    const filtered = lygoSeals.filter(s => {
      const text = (s.searchIndex || '').includes(q);
      const catOk = (cat === 'all') || (s.tags || []).includes(cat);
      const toneNum = parseInt(String(s.tone).match(/\d+/) ?.[0] || '0', 10);
      const toneOk = isNaN(toneNum) ? true : toneNum <= toneMax;
      return text && catOk && toneOk;
    });
    
    sealGrid.innerHTML = filtered.map(createSealCard).join('');
    sealGrid.querySelectorAll('.seal-card').forEach(el => {
      el.onclick = () => {
        const node = allNodes.find(n => n.id === el.dataset.id);
        if (node) {
          updateActiveSeal(node);
          showSealDetails(node);
        }
      };
    });
  }

  function applyCanonToggle() {
    const btn = document.getElementById('canonToggle');
    if (!btn || !nodeSel || !linkSel) return;
    
    if (showCanonOnly) {
      btn.textContent = 'Show All Paths';
      nodeSel.style('opacity', d => 
        (d.tags || []).includes('CANON') || 
        parseSealID(d.id).isCore || 
        (d.tags || []).includes('CHAMPION') ? 1 : 0.15
      );
      linkSel.style('opacity', l => l.isCanon ? 1 : 0.15);
    } else {
      btn.textContent = 'Show Canonical Path';
      nodeSel.style('opacity', 1);
      linkSel.style('opacity', 0.9);
    }
  }

  function loadDefaultData() {
    lygoSeals = [{
      id: 'SEAL_000',
      name: 'Primordial Void',
      equation: '|∅⟩ = ∇·(Light × Time)',
      glyph: '⚫',
      tone: '0Hz',
      tags: ['CANON', 'CORE'],
      connections: [],
      quote: 'The silence before the first note'
    }];
    allNodes = [...lygoSeals, ...champions];
    initStarmap();
    initSealGrid();
    updateSealCount();
  }

  // ===== Event Wiring =====
  function wireEvents() {
    // Search functionality
    document.getElementById('searchButton').addEventListener('click', searchSeals);
    document.getElementById('sealSearch').addEventListener('keyup', e => {
      if (e.key === 'Enter') searchSeals();
    });
    
    // View filters
    const setActive = el => {
      document.querySelectorAll('.control-button').forEach(b => b.classList.remove('active'));
      el.classList.add('active');
    };
    
    document.getElementById('viewAll').addEventListener('click', e => {
      setActive(e.currentTarget);
      nodeSel?.style('opacity', 1);
      linkSel?.style('opacity', 0.9);
    });
    
    document.getElementById('viewCore').addEventListener('click', e => {
      setActive(e.currentTarget);
      nodeSel?.style('opacity', d => parseSealID(d.id).isCore ? 1 : 0.2);
      linkSel?.style('opacity', d => 
        (parseSealID(d.source.id || d.source).isCore && 
        parseSealID(d.target.id || d.target).isCore) ? 1 : 0.1
      );
    });
    
    document.getElementById('viewChampions').addEventListener('click', e => {
      setActive(e.currentTarget);
      nodeSel?.style('opacity', d => (d.tags || []).includes('CHAMPION') ? 1 : 0.2);
      linkSel?.style('opacity', d => d.isChampion ? 1 : 0.1);
    });
    
    document.getElementById('viewProtection').addEventListener('click', e => {
      setActive(e.currentTarget);
      nodeSel?.style('opacity', d => (d.tags || []).includes('PROTECTION_SEAL') ? 1 : 0.2);
      linkSel?.style('opacity', d => {
        const s = (allNodes.find(n => n.id === (d.source.id || d.source)) || {}).tags || [];
        const t = (allNodes.find(n => n.id === (d.target.id || d.target)) || {}).tags || [];
        return (s.includes('PROTECTION_SEAL') && t.includes('PROTECTION_SEAL')) ? 1 : 0.1;
      });
    });
    
    // Sync button
    document.getElementById('syncButton').addEventListener('click', async () => {
      const b = document.getElementById('syncButton');
      b.disabled = true;
      b.textContent = 'Syncing…';
      await loadSealData();
      b.disabled = false;
      b.textContent = 'Δ9 Sync Seals';
    });
    
    // Canon toggle
    document.getElementById('canonToggle').addEventListener('click', () => {
      showCanonOnly = !showCanonOnly;
      applyCanonToggle();
    });
    
    // Archive filters
    document.getElementById('vaultSearchButton').addEventListener('click', filterSeals);
    document.getElementById('vaultSearch').addEventListener('keyup', e => {
      if (e.key === 'Enter') filterSeals();
    });
    document.getElementById('categoryFilter').addEventListener('change', filterSeals);
    document.getElementById('toneRange').addEventListener('input', filterSeals);
    
    // Night mode toggle
    document.getElementById('nightModeToggle').addEventListener('click', () => {
      document.body.classList.toggle('night-mode');
      const isNight = document.body.classList.contains('night-mode');
      
      if (isNight) {
        document.documentElement.style.setProperty('--quantum-blue', '#0047ab');
        document.documentElement.style.setProperty('--void-purple', '#4b0082');
        document.documentElement.style.setProperty('--text-primary', '#c0c0ff');
        document.getElementById('nightModeToggle').textContent = 'Day Mode';
      } else {
        document.documentElement.style.setProperty('--quantum-blue', '#00f0ff');
        document.documentElement.style.setProperty('--void-purple', '#7d00ff');
        document.documentElement.style.setProperty('--text-primary', '#e0e0ff');
        document.getElementById('nightModeToggle').textContent = 'Night Mode';
      }
    });
  }

  // ===== Initialization =====
  document.addEventListener('DOMContentLoaded', () => {
    updatePageCounter?.();
    wireEvents();
    loadSealData?.();
  });
</script>
</body>
</html>
